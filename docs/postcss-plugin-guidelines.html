<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta property="og:type" content="article"><meta property="og:url" content="http://postcss.org/"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@postcss"><meta name="twitter:creator" content="@postcss"><meta name="description" content="Transform CSS with the power of JavaScript. Auto-prefixing, future CSS syntaxes, modules, linting and more are possible with hundreds of PostCSS plugins."><link rel="icon" type="image/x-icon" sizes="any" href="/docs/assets/favicon-659f5617.ico"><link rel="icon" href="/docs/assets/logo-3e39b0aa.svg" type="image/svg+xml"><meta property="og:image" content="./base/og.jpg"><title>PostCSS Plugin Guidelines</title><script>((window.gitter = {}).chat = {}).options = {room: 'postcss/postcss'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async></script>  <script type="module" crossorigin src="/docs/assets/docs-2a00dca6.js"></script>
  <link rel="stylesheet" href="/docs/assets/docs-b9f20a05.css">
</head><body><main><div class="hero is-small"><a class="hero_home" rel="home" href="/"><img class="hero_logo" src="/docs/assets/postcss-83d93145.svg" alt="PostCSS logo"></a></div><nav class="nav"><ul class="nav_items"><li class="nav_item"><a class="nav_link" href="https://github.com/postcss/postcss#usage">Setup</a></li><li class="nav_item"><a class="nav_link" href="/docs/">Docs</a></li><li class="nav_item"><a class="nav_link" href="https://www.postcss.parts/">Plugins</a></li><li class="nav_item"><a class="nav_link" href="/api/">API</a></li><li class="nav_item"><a class="nav_link" href="https://github.com/postcss/brand">Logo</a></li></ul></nav><nav class="sidemenu"><ul><li class="sidemenu_item"><div class="sidemenu_bar"><a href="postcss-plugin-guidelines#api" class="sidemenu_section">1. API</a><button class="sidemenu_controller"></button></div><ul class="sidemenu_children"><li><a href="postcss-plugin-guidelines#do-one-thing,-and-do-it-well" class="sidemenu_child">1.2. Do one thing, and do it well</a></li><li><a href="postcss-plugin-guidelines#do-not-use-mixins" class="sidemenu_child">1.3. Do not use mixins</a></li><li><a href="postcss-plugin-guidelines#keep-postcss-to-peerdependencies" class="sidemenu_child">1.4. Keep postcss to peerDependencies</a></li><li><a href="postcss-plugin-guidelines#" class="sidemenu_child"></a></li><li><a href="postcss-plugin-guidelines#set-pluginpostcssplugin-with-plugin-name" class="sidemenu_child">1.5. Set plugin.postcssPlugin with plugin name</a></li></ul></li><li class="sidemenu_item"><div class="sidemenu_bar"><a href="postcss-plugin-guidelines#processing" class="sidemenu_section">2. Processing</a><button class="sidemenu_controller"></button></div><ul class="sidemenu_children"><li><a href="postcss-plugin-guidelines#plugin-must-be-tested" class="sidemenu_child">2.1. Plugin must be tested</a></li><li><a href="postcss-plugin-guidelines#use-asynchronous-methods-whenever-possible" class="sidemenu_child">2.2. Use asynchronous methods whenever possible</a></li><li><a href="postcss-plugin-guidelines#use-fast-node’s-scanning" class="sidemenu_child">2.3. Use fast node’s scanning</a></li><li><a href="postcss-plugin-guidelines#set-nodesource-for-new-nodes" class="sidemenu_child">2.4. Set node.source for new nodes</a></li><li><a href="postcss-plugin-guidelines#use-only-the-public-postcss-api" class="sidemenu_child">2.5. Use only the public PostCSS API</a></li></ul></li><li class="sidemenu_item"><div class="sidemenu_bar"><a href="postcss-plugin-guidelines#dependencies" class="sidemenu_section">3. Dependencies</a><button class="sidemenu_controller"></button></div><ul class="sidemenu_children"><li><a href="postcss-plugin-guidelines#use-messages-to-specify-dependencies" class="sidemenu_child">3.1. Use messages to specify dependencies</a></li></ul></li><li class="sidemenu_item"><div class="sidemenu_bar"><a href="postcss-plugin-guidelines#errors" class="sidemenu_section">4. Errors</a><button class="sidemenu_controller"></button></div><ul class="sidemenu_children"><li><a href="postcss-plugin-guidelines#use-nodeerror-on-css-relevant-errors" class="sidemenu_child">4.1. Use node.error on CSS relevant errors</a></li><li><a href="postcss-plugin-guidelines#use-resultwarn-for-warnings" class="sidemenu_child">4.2. Use result.warn for warnings</a></li></ul></li><li class="sidemenu_item"><div class="sidemenu_bar"><a href="postcss-plugin-guidelines#documentation" class="sidemenu_section">5. Documentation</a><button class="sidemenu_controller"></button></div><ul class="sidemenu_children"><li><a href="postcss-plugin-guidelines#document-your-plugin-in-english" class="sidemenu_child">5.1. Document your plugin in English</a></li><li><a href="postcss-plugin-guidelines#include-input-and-output-examples" class="sidemenu_child">5.2. Include input and output examples</a></li><li><a href="postcss-plugin-guidelines#maintain-a-changelog" class="sidemenu_child">5.3. Maintain a changelog</a></li><li><a href="postcss-plugin-guidelines#include-postcss-plugin-keyword-in-packagejson" class="sidemenu_child">5.4. Include postcss-plugin keyword in package.json</a></li><li><a href="postcss-plugin-guidelines#" class="sidemenu_child"></a></li></ul></li></ul></nav><article class="doc"><h1 class="doc_title">PostCSS Plugin Guidelines</h1><p>A PostCSS plugin is a function that receives and, usually,
transforms a CSS AST from the PostCSS parser.</p><p>The rules below are <em>mandatory</em> for all PostCSS plugins.</p><p>See also <a href="http://blog.clojurewerkz.org/blog/2013/04/20/how-to-make-your-open-source-project-really-awesome/">ClojureWerkz’s recommendations</a> for open source projects.</p><h2 class="doc_subtitle" id="api">1. API</h2><h3 class="doc_subtitle" id="clear-name-with-postcss-prefix">1.1 Clear name with <code>postcss-</code> prefix</h3><p>The plugin’s purpose should be clear just by reading its name.
If you wrote a transpiler for CSS 4 Custom Media, <code>postcss-custom-media</code>
would be a good name. If you wrote a plugin to support mixins,
<code>postcss-mixins</code> would be a good name.</p><p>The prefix <code>postcss-</code> shows that the plugin is part of the PostCSS ecosystem.</p><p>This rule is not mandatory for plugins that can run as independent tools,
without the user necessarily knowing that it is powered by
PostCSS — for example, <a href="https://rtlcss.com/">RTLCSS</a> and <a href="https://github.com/postcss/autoprefixer">Autoprefixer</a>.</p><h3 class="doc_subtitle" id="do-one-thing,-and-do-it-well">1.2. Do one thing, and do it well</h3><p>Do not create multitool plugins. Several small, one-purpose plugins bundled into
a plugin pack is usually a better solution.</p><p>For example, <a href="https://preset-env.cssdb.org/"><code>postcss-preset-env</code></a> contains many small plugins,
one for each W3C specification. And <a href="https://github.com/ben-eb/cssnano"><code>cssnano</code></a> contains a separate plugin
for each of its optimization.</p><h3 class="doc_subtitle" id="do-not-use-mixins">1.3. Do not use mixins</h3><p>Preprocessors libraries like Compass provide an API with mixins.</p><p>PostCSS plugins are different.
A plugin cannot be just a set of mixins for <a href="https://github.com/postcss/postcss-mixins"><code>postcss-mixins</code></a>.</p><p>To achieve your goal, consider transforming valid CSS
or using custom at-rules and custom properties.</p><h3 class="doc_subtitle" id="keep-postcss-to-peerdependencies">1.4. Keep <code>postcss</code> to <code>peerDependencies</code></h3><p>AST can be broken because of different <code>postcss</code> version in different plugins.
Different plugins could use a different node creators (like <code>postcss.decl()</code>).</p><pre><code class="code language-json"><span class="code-punctuation">{</span>
  <span class="code-attr">"peerDependencies"</span><span class="code-punctuation">:</span> <span class="code-punctuation">{</span>
    <span class="code-attr">"postcss"</span><span class="code-punctuation">:</span> <span class="code-string">"^8.0.0"</span>
  <span class="code-punctuation">}</span>
<span class="code-punctuation">}</span>
</code></pre><p>It is better even not to import <code>postcss</code>.</p><pre><code class="code language-diff"><span class="code-deletion">- const { list, decl } = require('postcss')</span>
  module.exports = opts => {
    postcssPlugin: 'postcss-name',
<span class="code-deletion">-   Once (root) {</span>
<span class="code-addition">+   Once (root, { list, decl }) {</span>
      // Plugin code
    }
  }
  module.exports.postcss = true
</code></pre><h3 class="doc_subtitle" id="set-pluginpostcssplugin-with-plugin-name">1.5. Set <code>plugin.postcssPlugin</code> with plugin name</h3><p>Plugin name will be used in error messages and warnings.</p><pre><code class="code language-js"><span class="code-variable language_">module</span>.<span class="code-property">exports</span> = <span class="code-function"><span class="code-params">opts</span> =></span> {
  <span class="code-keyword">return</span> {
    <span class="code-attr">postcssPlugin</span>: <span class="code-string">'postcss-name'</span>,
    <span class="code-title class_">Once</span> (root) {
      <span class="code-comment">// Plugin code</span>
    }
  }
}
<span class="code-variable language_">module</span>.<span class="code-property">exports</span>.<span class="code-property">postcss</span> = <span class="code-literal">true</span>
</code></pre><h2 class="doc_subtitle" id="processing">2. Processing</h2><h3 class="doc_subtitle" id="plugin-must-be-tested">2.1. Plugin must be tested</h3><p>A CI service like <a href="https://travis-ci.org/">Travis</a> is also recommended for testing code in
different environments. You should test in (at least) Node.js <a href="https://github.com/nodejs/LTS">active LTS</a> and current stable version.</p><h3 class="doc_subtitle" id="use-asynchronous-methods-whenever-possible">2.2. Use asynchronous methods whenever possible</h3><p>For example, use <code>fs.writeFile</code> instead of <code>fs.writeFileSync</code>:</p><pre><code class="code language-js"><span class="code-keyword">let</span> { readFile } = <span class="code-built_in">require</span>(<span class="code-string">'fs'</span>).<span class="code-property">promises</span>

<span class="code-variable language_">module</span>.<span class="code-property">exports</span> = <span class="code-function"><span class="code-params">opts</span> =></span> {
  <span class="code-keyword">return</span> {
    <span class="code-attr">postcssPlugin</span>: <span class="code-string">'plugin-inline'</span>,
    <span class="code-keyword">async</span> <span class="code-title class_">Decl</span> (decl) {
      <span class="code-keyword">const</span> imagePath = <span class="code-title function_">findImage</span>(decl)
      <span class="code-keyword">if</span> (imagePath) {
        <span class="code-keyword">let</span> imageFile = <span class="code-keyword">await</span> <span class="code-title function_">readFile</span>(imagePath)
        decl.<span class="code-property">value</span> = <span class="code-title function_">replaceUrl</span>(decl.<span class="code-property">value</span>, imageFile)
      }
    }
  }
}
<span class="code-variable language_">module</span>.<span class="code-property">exports</span>.<span class="code-property">postcss</span> = <span class="code-literal">true</span>
</code></pre><h3 class="doc_subtitle" id="use-fast-node’s-scanning">2.3. Use fast node’s scanning</h3><p>Subscribing for specific node type is much faster, than calling <code>walk*</code> method:</p><pre><code class="code language-diff">  module.exports = {
    postcssPlugin: 'postcss-example',
<span class="code-deletion">-   Once (root) {</span>
<span class="code-deletion">-     root.walkDecls(decl => {</span>
<span class="code-deletion">-       // Slow</span>
<span class="code-deletion">-     })</span>
<span class="code-deletion">-   }</span>
<span class="code-addition">+   Declaration (decl) {</span>
<span class="code-addition">+     // Faster</span>
<span class="code-addition">+   }</span>
  }
  module.exports.postcss = true
</code></pre><p>But you can make scanning even faster, if you know, what declaration’s property
or at-rule’s name do you need:</p><pre><code class="code language-diff">  module.exports = {
    postcssPlugin: 'postcss-example',
<span class="code-deletion">-   Declaration (decl) {</span>
<span class="code-deletion">-     if (decl.prop === 'color') {</span>
<span class="code-deletion">-       // Faster</span>
<span class="code-deletion">-     }</span>
<span class="code-deletion">-   }</span>
<span class="code-addition">+   Declaration: {</span>
<span class="code-addition">+     color: decl => {</span>
<span class="code-addition">+       // The fastest</span>
<span class="code-addition">+     }</span>
<span class="code-addition">+   }</span>
  }
  module.exports.postcss = true
</code></pre><h3 class="doc_subtitle" id="set-nodesource-for-new-nodes">2.4. Set <code>node.source</code> for new nodes</h3><p>Every node must have a relevant <code>source</code> so PostCSS can generate
an accurate source map.</p><p>So if you add a new declaration based on some existing declaration, you should
clone the existing declaration in order to save that original <code>source</code>.</p><pre><code class="code language-js"><span class="code-keyword">if</span> (<span class="code-title function_">needPrefix</span>(decl.<span class="code-property">prop</span>)) {
  decl.<span class="code-title function_">cloneBefore</span>({ <span class="code-attr">prop</span>: <span class="code-string">'-webkit-'</span> + decl.<span class="code-property">prop</span> })
}
</code></pre><p>You can also set <code>source</code> directly, copying from some existing node:</p><pre><code class="code language-js"><span class="code-keyword">if</span> (decl.<span class="code-property">prop</span> === <span class="code-string">'animation'</span>) {
  <span class="code-keyword">const</span> keyframe = <span class="code-title function_">createAnimationByName</span>(decl.<span class="code-property">value</span>)
  keyframes.<span class="code-property">source</span> = decl.<span class="code-property">source</span>
  decl.<span class="code-title function_">root</span>().<span class="code-title function_">append</span>(keyframes)
}
</code></pre><h3 class="doc_subtitle" id="use-only-the-public-postcss-api">2.5. Use only the public PostCSS API</h3><p>PostCSS plugins must not rely on undocumented properties or methods,
which may be subject to change in any minor release. The public API
is described in <a href="https://postcss.org/api/">API docs</a>.</p><h2 class="doc_subtitle" id="dependencies">3. Dependencies</h2><h3 class="doc_subtitle" id="use-messages-to-specify-dependencies">3.1. Use messages to specify dependencies</h3><p>If a plugin depends on another file, it should be specified by attaching
a <code>dependency</code> message to the <code>result</code>:</p><pre><code class="code language-js">result.<span class="code-property">messages</span>.<span class="code-title function_">push</span>({
  <span class="code-attr">type</span>: <span class="code-string">'dependency'</span>,
  <span class="code-attr">plugin</span>: <span class="code-string">'postcss-import'</span>,
  <span class="code-attr">file</span>: <span class="code-string">'/imported/file.css'</span>,
  <span class="code-attr">parent</span>: result.<span class="code-property">opts</span>.<span class="code-property">from</span>
})
</code></pre><p>Directory dependencies should be specified using the <code>dir-dependency</code> message
type. By default all files within the directory (recursively) are considered
dependencies. An optional <code>glob</code> property can be used to indicate that only
files matching a specific glob pattern should be considered.</p><pre><code class="code language-js">result.<span class="code-property">messages</span>.<span class="code-title function_">push</span>({
  <span class="code-attr">type</span>: <span class="code-string">'dir-dependency'</span>,
  <span class="code-attr">plugin</span>: <span class="code-string">'postcss-import'</span>,
  <span class="code-attr">dir</span>: <span class="code-string">'/imported'</span>,
  <span class="code-attr">glob</span>: <span class="code-string">'**/*.css'</span>, <span class="code-comment">// optional</span>
  <span class="code-attr">parent</span>: result.<span class="code-property">opts</span>.<span class="code-property">from</span>
})
</code></pre><h2 class="doc_subtitle" id="errors">4. Errors</h2><h3 class="doc_subtitle" id="use-nodeerror-on-css-relevant-errors">4.1. Use <code>node.error</code> on CSS relevant errors</h3><p>If you have an error because of input CSS (like an unknown name
in a mixin plugin) you should use <code>node.error</code> to create an error
that includes source position:</p><pre><code class="code language-js"><span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> mixins[name] === <span class="code-string">'undefined'</span>) {
  <span class="code-keyword">throw</span> node.<span class="code-title function_">error</span>(<span class="code-string">'Unknown mixin '</span> + name)
}
</code></pre><h3 class="doc_subtitle" id="use-resultwarn-for-warnings">4.2. Use <code>result.warn</code> for warnings</h3><p>Do not print warnings with <code>console.log</code> or <code>console.warn</code>,
because some PostCSS runner may not allow console output.</p><pre><code class="code language-js"><span class="code-title class_">Declaration</span> (decl, { result }) {
  <span class="code-keyword">if</span> (<span class="code-title function_">outdated</span>(decl.<span class="code-property">prop</span>)) {
    result.<span class="code-title function_">warn</span>(decl.<span class="code-property">prop</span> + <span class="code-string">' is outdated'</span>, { <span class="code-attr">node</span>: decl })
  }
}
</code></pre><p>If CSS input is a source of the warning, the plugin must set the <code>node</code> option.</p><h2 class="doc_subtitle" id="documentation">5. Documentation</h2><h3 class="doc_subtitle" id="document-your-plugin-in-english">5.1. Document your plugin in English</h3><p>PostCSS plugins must have their <code>README.md</code> wrote in English. Do not be afraid
of your English skills, as the open source community will fix your errors.</p><p>Of course, you are welcome to write documentation in other languages;
just name them appropriately (e.g. <code>README.ja.md</code>).</p><h3 class="doc_subtitle" id="include-input-and-output-examples">5.2. Include input and output examples</h3><p>The plugin's <code>README.md</code> must contain example input and output CSS.
A clear example is the best way to describe how your plugin works.</p><p>The first section of the <code>README.md</code> is a good place to put examples.
See <a href="https://github.com/iamvdo/postcss-opacity">postcss-opacity</a> for an example.</p><p>Of course, this guideline does not apply if your plugin does not
transform the CSS.</p><h3 class="doc_subtitle" id="maintain-a-changelog">5.3. Maintain a changelog</h3><p>PostCSS plugins must describe the changes of all their releases
in a separate file, such as <code>CHANGELOG.md</code>, <code>History.md</code>, or <a href="https://help.github.com/articles/creating-releases/">GitHub Releases</a>.
Visit <a href="https://keepachangelog.com/">Keep A Changelog</a> for more information about how to write one of these.</p><p>Of course, you should be using <a href="https://semver.org/">SemVer</a>.</p><h3 class="doc_subtitle" id="include-postcss-plugin-keyword-in-packagejson">5.4. Include <code>postcss-plugin</code> keyword in <code>package.json</code></h3><p>PostCSS plugins written for npm must have the <code>postcss-plugin</code> keyword
in their <code>package.json</code>. This special keyword will be useful for feedback about
the PostCSS ecosystem.</p><p>For packages not published to npm, this is not mandatory, but is recommended
if the package format can contain keywords.</p></article><aside class="socials"><ul class="socials_items"><li class="socials_item"><a class="socials_link is-open-collective" href="https://opencollective.com/postcss/" rel="me">Open Collective</a></li><li class="socials_item"><a class="socials_link is-twitter" href="https://twitter.com/postcss" rel="me">Twitter</a></li><li class="socials_item"><a class="socials_link is-gitter" href="https://gitter.im/postcss/postcss" rel="me">Gitter</a></li><li class="socials_item"><a class="socials_link is-github" href="https://github.com/postcss/postcss" rel="me">GitHub</a></li></ul></aside><footer class="footer"><div class="footer_inner"><div class="footer_info"><p class="footer_license">Distributed under the MIT License.</p><p class="footer_issue">Found an issue?<a class="footer_report" href="https://github.com/postcss/postcss.org/issues">Report it!</a></p></div><div><a href="https://evilmartians.com/?utm_source=postcss&amp;utm_campaign=homepage"><img alt="Evil Martians" src="/docs/assets/evilmartians-1daec88e.svg"></a></div></div></footer></main></body></html>
