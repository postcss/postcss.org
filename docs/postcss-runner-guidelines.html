<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta property="og:type" content="article"><meta property="og:url" content="http://postcss.org/"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@postcss"><meta name="twitter:creator" content="@postcss"><meta name="description" content="Transform CSS with the power of JavaScript. Auto-prefixing, future CSS syntaxes, modules, linting and more are possible with hundreds of PostCSS plugins."><link rel="icon" type="image/x-icon" sizes="any" href="/docs/assets/favicon-DbGqNhKa.ico"><link rel="icon" href="/docs/assets/logo-C2ryQugb.svg" type="image/svg+xml"><meta property="og:image" content="./base/og.jpg"><title>PostCSS Runner Guidelines</title>  <script type="module" crossorigin src="/docs/assets/docs-DfJ7jw4K.js"></script>
  <link rel="stylesheet" crossorigin href="/docs/assets/docs-BjbbsTFM.css">
</head><body><main><div class="hero is-small"><a class="hero_home" rel="home" href="/"><img class="hero_logo" src="/docs/assets/postcss-CsElRNOW.svg" alt="PostCSS logo"></a></div><nav class="nav"><ul class="nav_items"><li class="nav_item"><a class="nav_link" href="https://github.com/postcss/postcss#usage">Setup</a></li><li class="nav_item"><a class="nav_link" href="/docs/">Docs</a></li><li class="nav_item"><a class="nav_link" href="/docs/postcss-plugins">Plugins</a></li><li class="nav_item"><a class="nav_link" href="/api/">API</a></li><li class="nav_item"><a class="nav_link" href="https://github.com/postcss/brand">Logo</a></li></ul></nav><nav class="sidemenu"><ul><a href="postcss-runner-guidelines#api" class="sidemenu_section">1. API</a><li class="sidemenu_item"><div class="sidemenu_bar"><a href="postcss-runner-guidelines#processing" class="sidemenu_section">2. Processing</a><button class="sidemenu_controller"></button></div><ul class="sidemenu_children"><li><a href="postcss-runner-guidelines#set-from-and-to-processing-options" class="sidemenu_child">2.1. Set from and to processing options</a></li><li><a href="postcss-runner-guidelines#use-only-the-asynchronous-api" class="sidemenu_child">2.2. Use only the asynchronous API</a></li><li><a href="postcss-runner-guidelines#use-only-the-public-postcss-api" class="sidemenu_child">2.3. Use only the public PostCSS API</a></li></ul></li><li class="sidemenu_item"><div class="sidemenu_bar"><a href="postcss-runner-guidelines#dependencies" class="sidemenu_section">3. Dependencies</a><button class="sidemenu_controller"></button></div><ul class="sidemenu_children"><li><a href="postcss-runner-guidelines#rebuild-when-dependencies-change" class="sidemenu_child">3.1. Rebuild when dependencies change</a></li></ul></li><li class="sidemenu_item"><div class="sidemenu_bar"><a href="postcss-runner-guidelines#output" class="sidemenu_section">4. Output</a><button class="sidemenu_controller"></button></div><ul class="sidemenu_children"><li><a href="postcss-runner-guidelines#don’t-show-js-stack-for-csssyntaxerror" class="sidemenu_child">4.1. Don’t show JS stack for CssSyntaxError</a></li><li><a href="postcss-runner-guidelines#" class="sidemenu_child"></a></li><li><a href="postcss-runner-guidelines#display-resultwarnings()" class="sidemenu_child">4.2. Display result.warnings()</a></li><li><a href="postcss-runner-guidelines#" class="sidemenu_child"></a></li><li><a href="postcss-runner-guidelines#allow-the-user-to-write-source-maps-to-different-files" class="sidemenu_child">4.3. Allow the user to write source maps to different files</a></li></ul></li><li class="sidemenu_item"><div class="sidemenu_bar"><a href="postcss-runner-guidelines#documentation" class="sidemenu_section">5. Documentation</a><button class="sidemenu_controller"></button></div><ul class="sidemenu_children"><li><a href="postcss-runner-guidelines#document-your-runner-in-english" class="sidemenu_child">5.1. Document your runner in English</a></li><li><a href="postcss-runner-guidelines#maintain-a-changelog" class="sidemenu_child">5.2. Maintain a changelog</a></li><li><a href="postcss-runner-guidelines#postcss-runner-keyword-in-packagejson" class="sidemenu_child">5.3. postcss-runner keyword in package.json</a></li><li><a href="postcss-runner-guidelines#" class="sidemenu_child"></a></li><li><a href="postcss-runner-guidelines#keep-postcss-to-peerdependencies" class="sidemenu_child">5.4. Keep postcss to peerDependencies</a></li><li><a href="postcss-runner-guidelines#" class="sidemenu_child"></a></li></ul></li></ul></nav><article class="doc"><h1 class="doc_title">PostCSS Runner Guidelines</h1><p>A PostCSS runner is a tool that processes CSS through a user-defined list
of plugins; for example, <a href="https://github.com/postcss/postcss-cli"><code>postcss-cli</code></a> or <a href="https://github.com/w0rm/gulp-postcss"><code>gulp‑postcss</code></a>.
These rules are mandatory for any such runners.</p><p>For single-plugin tools, like <a href="https://github.com/sindresorhus/gulp-autoprefixer"><code>gulp-autoprefixer</code></a>,
these rules are not mandatory but are highly recommended.</p><p>See also <a href="http://blog.clojurewerkz.org/blog/2013/04/20/how-to-make-your-open-source-project-really-awesome/">ClojureWerkz’s recommendations</a> for open source projects.</p><h2 class="doc_subtitle" id="api">1. API</h2><h3 class="doc_subtitle" id="accept-functions-in-plugin-parameters">1.1. Accept functions in plugin parameters</h3><p>If your runner uses a config file, it must be written in JavaScript, so that
it can support plugins which accept a function, such as <a href="https://github.com/borodean/postcss-assets"><code>postcss-assets</code></a>:</p><pre><code class="code language-js"><span class="code-variable language_">module</span>.<span class="code-property">exports</span> = [
  <span class="code-built_in">require</span>(<span class="code-string">'postcss-assets'</span>)({
    <span class="code-attr">cachebuster</span>: <span class="code-keyword">function</span> (<span class="code-params">file</span>) {
      <span class="code-keyword">return</span> fs.<span class="code-title function_">statSync</span>(file).<span class="code-property">mtime</span>.<span class="code-title function_">getTime</span>().<span class="code-title function_">toString</span>(<span class="code-number">16</span>)
    }
  })
]
</code></pre><h2 class="doc_subtitle" id="processing">2. Processing</h2><h3 class="doc_subtitle" id="set-from-and-to-processing-options">2.1. Set <code>from</code> and <code>to</code> processing options</h3><p>To ensure that PostCSS generates source maps and displays better syntax errors,
runners must specify the <code>from</code> and <code>to</code> options. If your runner does not handle
writing to disk (for example, a gulp transform), you should set both options
to point to the same file:</p><pre><code class="code language-js">processor.<span class="code-title function_">process</span>({ <span class="code-attr">from</span>: file.<span class="code-property">path</span>, <span class="code-attr">to</span>: file.<span class="code-property">path</span> })
</code></pre><h3 class="doc_subtitle" id="use-only-the-asynchronous-api">2.2. Use only the asynchronous API</h3><p>PostCSS runners must use only the asynchronous API.
The synchronous API is provided only for debugging, is slower,
and can’t work with asynchronous plugins.</p><pre><code class="code language-js">processor.<span class="code-title function_">process</span>(opts).<span class="code-title function_">then</span>(<span class="code-function"><span class="code-params">result</span> =></span> {
  <span class="code-comment">// processing is finished</span>
});
</code></pre><h3 class="doc_subtitle" id="use-only-the-public-postcss-api">2.3. Use only the public PostCSS API</h3><p>PostCSS runners must not rely on undocumented properties or methods,
which may be subject to change in any minor release. The public API
is described in <a href="https://postcss.org/api/">API docs</a>.</p><h2 class="doc_subtitle" id="dependencies">3. Dependencies</h2><h3 class="doc_subtitle" id="rebuild-when-dependencies-change">3.1. Rebuild when dependencies change</h3><p>PostCSS plugins may declare file or directory dependencies by attaching
messages to the <code>result</code>. Runners should watch these and ensure that the
CSS is rebuilt when they change.</p><pre><code class="code language-js"><span class="code-keyword">for</span> (<span class="code-keyword">let</span> message <span class="code-keyword">of</span> result.<span class="code-property">messages</span>) {
  <span class="code-keyword">if</span> (message.<span class="code-property">type</span> === <span class="code-string">'dependency'</span>) {
    watcher.<span class="code-title function_">addFile</span>(message.<span class="code-property">file</span>)
  } <span class="code-keyword">else</span> <span class="code-keyword">if</span> (message.<span class="code-property">type</span> === <span class="code-string">'dir-dependency'</span> &#x26;&#x26; message.<span class="code-property">glob</span>) {
    watcher.<span class="code-title function_">addPattern</span>(file.<span class="code-title function_">join</span>(message.<span class="code-property">dir</span>, message.<span class="code-property">glob</span>))
  } <span class="code-keyword">else</span> <span class="code-keyword">if</span> (message.<span class="code-property">type</span> === <span class="code-string">'dir-dependency'</span>) {
    watcher.<span class="code-title function_">addPattern</span>(file.<span class="code-title function_">join</span>(message.<span class="code-property">dir</span>, <span class="code-string">'**'</span>, <span class="code-string">'*'</span>))
  }
}
</code></pre><p>Directories should be watched recursively by default, but <code>dir-dependency</code>
messages may contain an optional <code>glob</code> property indicating which files
within the directory are depended on (e.g. <code>**/*.css</code>). If <code>glob</code> is
specified then runners should only watch files matching the glob pattern,
where possible.</p><h2 class="doc_subtitle" id="output">4. Output</h2><h3 class="doc_subtitle" id="don’t-show-js-stack-for-csssyntaxerror">4.1. Don’t show JS stack for <code>CssSyntaxError</code></h3><p>PostCSS runners must not show a stack trace for CSS syntax errors,
as the runner can be used by developers who are not familiar with JavaScript.
Instead, handle such errors gracefully:</p><pre><code class="code language-js">processor.<span class="code-title function_">process</span>(opts).<span class="code-title function_">catch</span>(<span class="code-function"><span class="code-params">error</span> =></span> {
  <span class="code-keyword">if</span> (error.<span class="code-property">name</span> === <span class="code-string">'CssSyntaxError'</span>) {
    process.<span class="code-property">stderr</span>.<span class="code-title function_">write</span>(error.<span class="code-property">message</span> + error.<span class="code-title function_">showSourceCode</span>())
  } <span class="code-keyword">else</span> {
    <span class="code-keyword">throw</span> error
  }
})
</code></pre><h3 class="doc_subtitle" id="display-resultwarnings()">4.2. Display <code>result.warnings()</code></h3><p>PostCSS runners must output warnings from <code>result.warnings()</code>:</p><pre><code class="code language-js">result.<span class="code-title function_">warnings</span>().<span class="code-title function_">forEach</span>(<span class="code-function"><span class="code-params">warn</span> =></span> {
  process.<span class="code-property">stderr</span>.<span class="code-title function_">write</span>(warn.<span class="code-title function_">toString</span>())
})
</code></pre><p>See also <a href="https://github.com/davidtheclark/postcss-log-warnings">postcss-log-warnings</a> and <a href="https://github.com/postcss/postcss-messages">postcss-messages</a> plugins.</p><h3 class="doc_subtitle" id="allow-the-user-to-write-source-maps-to-different-files">4.3. Allow the user to write source maps to different files</h3><p>PostCSS by default will inline source maps in the generated file; however,
PostCSS runners must provide an option to save the source map in a different
file:</p><pre><code class="code language-js"><span class="code-keyword">if</span> (result.<span class="code-property">map</span>) {
  fs.<span class="code-title function_">writeFile</span>(opts.<span class="code-property">to</span> + <span class="code-string">'.map'</span>, result.<span class="code-property">map</span>.<span class="code-title function_">toString</span>())
}
</code></pre><h2 class="doc_subtitle" id="documentation">5. Documentation</h2><h3 class="doc_subtitle" id="document-your-runner-in-english">5.1. Document your runner in English</h3><p>PostCSS runners must have their <code>README.md</code> written in English. Do not be afraid
of your English skills, as the open source community will fix your errors.</p><p>Of course, you are welcome to write documentation in other languages;
just name them appropriately (e.g. <code>README.ja.md</code>).</p><h3 class="doc_subtitle" id="maintain-a-changelog">5.2. Maintain a changelog</h3><p>PostCSS runners must describe changes of all releases in a separate file,
such as <code>ChangeLog.md</code>, <code>History.md</code>, or with <a href="https://help.github.com/articles/creating-releases/">GitHub Releases</a>.
Visit <a href="https://keepachangelog.com/">Keep A Changelog</a> for more information on how to write one of these.</p><p>Of course, you should use <a href="https://semver.org/">SemVer</a>.</p><h3 class="doc_subtitle" id="postcss-runner-keyword-in-packagejson">5.3. <code>postcss-runner</code> keyword in <code>package.json</code></h3><p>PostCSS runners written for npm must have the <code>postcss-runner</code> keyword
in their <code>package.json</code>. This special keyword will be useful for feedback about
the PostCSS ecosystem.</p><p>For packages not published to npm, this is not mandatory, but recommended
if the package format is allowed to contain keywords.</p><h3 class="doc_subtitle" id="keep-postcss-to-peerdependencies">5.4. Keep <code>postcss</code> to <code>peerDependencies</code></h3><p>AST can be broken because of different <code>postcss</code> version in different plugins.
Different plugins could use a different node creators (like <code>postcss.decl()</code>).</p><pre><code class="code language-json"><span class="code-punctuation">{</span>
  <span class="code-attr">"peerDependencies"</span><span class="code-punctuation">:</span> <span class="code-punctuation">{</span>
    <span class="code-attr">"postcss"</span><span class="code-punctuation">:</span> <span class="code-string">"^8.0.0"</span>
  <span class="code-punctuation">}</span>
<span class="code-punctuation">}</span>
</code></pre></article><aside class="socials"><ul class="socials_items"><li class="socials_item"><a class="socials_link is-open-collective" href="https://opencollective.com/postcss/" rel="me">Open Collective</a></li><li class="socials_item"><a class="socials_link is-twitter" href="https://twitter.com/postcss" rel="me">Twitter</a></li><li class="socials_item"><a class="socials_link is-github" href="https://github.com/postcss/postcss" rel="me">GitHub</a></li></ul></aside><footer class="footer"><div class="footer_inner"><div class="footer_info"><p class="footer_license">Distributed under the MIT License.</p><p class="footer_issue">Found an issue?<a class="footer_report" href="https://github.com/postcss/postcss.org/issues">Report it!</a></p></div><div><a href="https://evilmartians.com/?utm_source=postcss&amp;utm_campaign=homepage"><img alt="Evil Martians" src="/docs/assets/evilmartians-bzYkprTm.svg"></a></div></div></footer></main></body></html>
